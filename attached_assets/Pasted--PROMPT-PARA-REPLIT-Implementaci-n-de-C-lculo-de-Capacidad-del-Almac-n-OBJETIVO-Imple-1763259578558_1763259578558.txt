# üìã PROMPT PARA REPLIT: Implementaci√≥n de C√°lculo de Capacidad del Almac√©n

## üéØ OBJETIVO
Implementar la l√≥gica de c√°lculo de capacidad del almac√©n que muestre:
1. **N√∫mero de citas de descarga** en el periodo visible
2. **Porcentaje de capacidad del almac√©n** (0-100%+) basado en el recurso m√°s saturado

Este c√°lculo debe adaptarse a la vista activa (d√≠a/semana/mes) y considerar las ventanas de capacidad (capacity shifts) programadas.

---

## üìä REQUISITOS FUNCIONALES

### 1. C√°lculo de Capacidad por Recurso

Para cada recurso (workers, forklifts, docks), calcular:

**Capacidad Total Disponible:**
```typescript
// Para el rango de fechas visible (d√≠a, semana o mes):
Para cada d√≠a en el rango:
  1. Obtener todos los capacity_shifts del d√≠a de la tabla capacity_shifts
  2. Si HAY shifts programados:
     Capacidad_D√≠a = Œ£ (cantidad_recurso √ó duraci√≥n_shift_minutos)
     
     Ejemplo:
     Shift 06:00-14:00 con 5 workers ‚Üí 5 √ó 480min = 2,400 worker-min
     Shift 14:00-22:00 con 3 workers ‚Üí 3 √ó 480min = 1,440 worker-min
     Total del d√≠a: 3,840 worker-min
  
  3. Si NO HAY shifts programados para el d√≠a:
     Usar horario por defecto: 06:00-22:00 (960 minutos)
     Capacidad_D√≠a = DEFAULT_WORKERS √ó 960
     // Donde: DEFAULT_WORKERS=3, DEFAULT_FORKLIFTS=2, DEFAULT_DOCKS=3
     
  4. Sumar capacidades de todos los d√≠as:
     Capacidad_Total_Recurso = Œ£ Capacidad_D√≠a

// Ejemplo para una semana:
Lunes: 3,840 worker-min
Martes: 3,840 worker-min  
Mi√©rcoles: 2,880 worker-min (sin shifts, usa default)
Jueves: 3,840 worker-min
Viernes: 3,840 worker-min
S√°bado: 0 worker-min (sin operaci√≥n)
Domingo: 0 worker-min (sin operaci√≥n)
Total semana: 18,240 worker-min disponibles
Uso Total de Recursos:

typescript

// Para todas las citas de descarga en el rango:
Para cada cita:
  Uso_Cita = workers_needed √ó duration_min
  
  Ejemplo:
  Cita A: 2 workers √ó 50 min = 100 worker-min
  Cita B: 3 workers √ó 120 min = 360 worker-min
  
Uso_Total_Recurso = Œ£ Uso_Cita
Porcentaje por Recurso:

typescript

Porcentaje_Recurso = (Uso_Total / Capacidad_Total) √ó 100

Ejemplo:
Workers: (460 / 18,240) √ó 100 = 2.52%
Forklifts: (780 / 12,160) √ó 100 = 6.41%
Docks: (340 / 18,240) √ó 100 = 1.86%
Capacidad del Almac√©n (Cuello de Botella):

typescript

Capacidad_Almac√©n = MAX(Porcentaje_Workers, Porcentaje_Forklifts, Porcentaje_Docks)

// En el ejemplo anterior:
Capacidad_Almac√©n = 6.41% (limitado por forklifts)
2. Adaptaci√≥n por Vista
Vista D√çA:

typescript

Rango: currentDate (un solo d√≠a)
Capacidad Total: Suma de shifts del d√≠a
Uso Total: Suma de citas del d√≠a
Resultado: Capacidad del d√≠a espec√≠fico
Vista SEMANA:

typescript

Rango: Todos los d√≠as de la semana visible (lun-dom)
Capacidad Total: Suma de shifts de los 7 d√≠as
Uso Total: Suma de citas de los 7 d√≠as
Resultado: Capacidad promedio de la semana

OPCIONAL (mostrar tambi√©n):
Capacidad_Pico = MAX(capacidad de cada d√≠a individual)
D√≠a_Pico = d√≠a con mayor capacidad
Vista MES:

typescript

Rango: Todos los d√≠as del mes visible (1-28/29/30/31)
Capacidad Total: Suma de shifts de todos los d√≠as
Uso Total: Suma de citas de todos los d√≠as
Resultado: Capacidad promedio del mes

OPCIONAL (mostrar tambi√©n):
Capacidad_Pico = MAX(capacidad de cada d√≠a individual)
D√≠a_Pico = d√≠a con mayor capacidad
3. Manejo de Casos Especiales
Caso A: D√≠a sin Capacity Shifts

typescript

Si capacity_shifts.filter(s => s.date === targetDate).length === 0:
  
  Usar valores por defecto:
  - Horario: 06:00-22:00 (960 minutos)
  - Workers: 3 √ó 960 = 2,880 worker-min
  - Forklifts: 2 √ó 960 = 1,920 forklift-min
  - Docks: 3 √ó 960 = 2,880 dock-min
  
  Marcar el d√≠a con flag: usesDefaultCapacity = true
  // Para mostrar indicador visual en UI
Caso B: Cita que Cruza entre Shifts

typescript

Cita: 13:00-15:00 (120 min, 3 workers, 2 forklifts)
Shift A: 06:00-14:00 (5 workers, 3 forklifts)
Shift B: 14:00-22:00 (3 workers, 2 forklifts)

Dividir la cita:
  Parte 1 (13:00-14:00): 60 min
    - Consumir de Shift A: 3 √ó 60 = 180 worker-min
    - Consumir de Shift A: 2 √ó 60 = 120 forklift-min
  
  Parte 2 (14:00-15:00): 60 min
    - Consumir de Shift B: 3 √ó 60 = 180 worker-min
    - Consumir de Shift B: 2 √ó 60 = 120 forklift-min

Total consumido:
  - Shift A pierde: 180 worker-min, 120 forklift-min
  - Shift B pierde: 180 worker-min, 120 forklift-min
Caso C: Cita en Hueco sin Shift

typescript

Cita: 13:00-15:00
Shift A: 06:00-14:00
(Sin shift de 14:00-15:00)
Shift B: 15:00-22:00

Dividir:
  Parte 1 (13:00-14:00): Usar capacidad de Shift A
  Parte 2 (14:00-15:00): Usar valores por defecto
  
  usesDefaultCapacity = true para esta cita